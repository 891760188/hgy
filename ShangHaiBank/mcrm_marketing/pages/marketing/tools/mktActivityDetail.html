<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>营销活动详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--公共js-->
		<script src="../../common/AppBooter.js"></script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">营销活动详情</h1>
		</header>
		<div class="mui-content dark-bg">
			<div id="des" class="mui-table-view mui-table-view-group">
				
			</div>
		</div>
		<div id="superBt" class="mui-icon mui-icon-plusempty superBt"></div>
		<div id="superMenu" class="superMenu">
			<ul>
				<li><a data-fn="modify();"><b>修改</b><i class="mui-icon mui-icon-compose"></i></a></li>
				<li><a data-fn="deleteData();"><b>删除</b><i class="mui-icon mui-icon-compose"></i></a></li>
				<!--<li><a data-fn="closes()"><b>关闭</b><i class="mui-icon mui-icon-compose"></i></a></li>-->
			</ul>
		</div>
	</body>
	<script>
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		mui('.mui-scroll-wrapper').scroll();
		var webview_style0 = {
			popGesture: "close"
		};	
		var id = _App.util.getUrlParamByName('id');
		var backPage;
		var actName;
		var mkChannel;
		var mkState;
		var mkType;
		var mkMode;
		var cost;
		var sign_select1;
		var sign_select2;
		var address;
		var actContent;
		var custDes;
		var managerDes;
		var proDes;
		var actAim;
		var remark;
		var mkModeArr = ['','市场开拓计划','市场、产品推介活动','客户联谊活动'];//营销方式
		var mkChannelArr = ['','柜面','CC','短信','邮件','微信','电话'];//营销渠道
		var marketStateArr = ['','暂存','已提交','执行中','正常关闭','到期关闭','已退回'];//营销活动状态
		var mkTypeArr = ['','风险产品类营销','理财产品类营销','增值服务类营销','存款产品类营销','贷款产品类营销','代理产品类营销','国债类产品营销','信用卡产品营销','基金类产品营销','事件类营销'];//营销活动类型
		var ids=_App.util.getUrlParamByName('id');
		var condition = {id:ids};
		var des=document.getElementById('des');
		YSUI.SuperBt();
		mui.plusReady(function(){
			backPage = plus.webview.getWebviewById("addMktActivityList.html");
			condition={id:id};
			ajaxRequest();
		});
		
		//修改
		function modify(){
			mui.openWindow({
				id: 'mktActivityModify.html',
				url: 'mktActivityModify.html',
				styles: webview_style0,
				extras:{
			        ids:ids,
			        actName:actName,
					mkChannel:mkChannel,
					mkState:mkState,
					mkType:mkType,
					mkMode:mkMode,
					cost:cost,
					sign_select1:sign_select1,
					sign_select2:sign_select2,
					address:address,
					actContent:actContent,
					custDes:custDes,
					managerDes:managerDes,
					proDes:proDes,
					actAim:actAim,
					remark:remark
			    },
				show: {
					aniShow: 'slide-in-right'
				},
				waiting: {
					autoShow: false
				}
			});
		}
		
		//删除
		function deleteData(){
			var btnArray = ['否', '是'];
			mui.confirm('确认要删除吗？', '提示', btnArray, function(e) {
				if (e.index == 1) {					
					_App.ajax({
						type : "POST",
						url : basePath+'marketActivityAction!delmarket.json',
						cache: false, 
						data: {ids:ids},
						dataType: "json", 
						success : function(response){
							mui.alert('删除成功！');
							if(backPage != null){
							  	mui.fire(backPage,'paramBackEvent__',{
								});	
						    }		
							plus.webview.currentWebview().close("mktActivityDetail.html");
						},error:function(){
							plus.nativeUI.closeWaiting();
							mui.alert('删除失败！');
						}
					});
				}
			});
		}
		//关闭
		function closes(){
			_App.ajax({
				type: "get",
				url: basePath + 'marketActivityAction!closeTask.json',
				cache: false,
				data: {ids:ids},
				dataType: "json",
				success: function(response) {
					mui.alert('关闭成功！');
					if(backPage != null){
					  	mui.fire(backPage,'paramBackEvent__',{
						});	
				    }		
					plus.webview.currentWebview().close("mktActivityDetail.html");
				},
				error:function(){
					plus.nativeUI.closeWaiting();
					mui.alert('加载失败！');
				}
			});
		}
		function ajaxRequest(){
			_App.ajax({
				type: "get",
				url: basePath + 'marketActivityAction.json?conditions=' + JSON.stringify(condition),
				cache: false,
				dataType: "json",
				success: function(response) {
					var data = response.json.data;
					actName = data[0].MKT_ACTI_NAME;
					mkChannel = data[0].MKT_CHANEL;
					mkState = data[0].MKT_ACTI_STAT;
					mkType = data[0].MKT_ACTI_TYPE;
					mkMode = data[0].MKT_ACTI_MODE;
					cost = data[0].MKT_ACTI_COST;
					sign_select1 = data[0].PSTART_DATE;
					sign_select2 = data[0].PEND_DATE;
					address = data[0].MKT_ACTI_ADDR;
					actContent = data[0].MKT_ACTI_CONT;
					custDes = data[0].ACTI_CUST_DESC;
					managerDes = data[0].ACTI_OPER_DESC;
					proDes = data[0].ACTI_PROD_DESC;
					actAim = data[0].MKT_ACTI_AIM;
					remark = data[0].ACTI_REMARK;
					des.innerHTML='<form class="mui-input-group"><div class="mui-input-row"><label>营销活动名称:</label><input id="actName" type="text" readonly="readonly" value="'+data[0].MKT_ACTI_NAME+'"></div>'
					+'<div class="mui-input-row"><label>营销渠道:</label><input id="actName" type="text" readonly="readonly" value="'+mkChannelArr[data[0].MKT_CHANEL]+'"></div>'
					+'<div class="mui-input-row"><label>营销活动类型:</label><input id="actName" type="text" readonly="readonly" value="'+mkTypeArr[data[0].MKT_ACTI_TYPE]+'"></div>'
					+'<div class="mui-input-row"><label>营销活动状态:</label><input id="actName" type="text" readonly="readonly" value="'+marketStateArr[data[0].MKT_ACTI_STAT]+'"></div>'
					+'<div class="mui-input-row"><label>营销方式:</label><input id="actName" type="text" readonly="readonly" value="'+mkModeArr[data[0].MKT_ACTI_MODE]+'"></div>'
					+'<div class="mui-input-row"><label>费用预算:</label><input id="cost" type="text" readonly="readonly" value="'+data[0].MKT_ACTI_COST+'"></div>'
					+'<div class="mui-input-row"><label>计划开始时间:</label><input type="text" readonly="readonly" value="'+data[0].PSTART_DATE+'"></div>'
					+'<div class="mui-input-row"><label>计划结束时间:</label><input type="text" readonly="readonly" value="'+data[0].PEND_DATE+'"></div>'
					+'<div class="mui-input-row"><label>活动地点:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].MKT_ACTI_ADDR+'</textarea></div>'
					+'<div class="mui-input-row"><label>营销活动内容:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].MKT_ACTI_CONT+'</textarea></div>'
					+'<div class="mui-input-row" style="height: 60px;"><label>涉及客户群描述:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].ACTI_CUST_DESC+'</textarea></div>'
					+'<div class="mui-input-row" style="height: 60px;"><label>涉及执行人描述:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].ACTI_OPER_DESC+'</textarea></div>'
					+'<div class="mui-input-row"><label>涉及产品描述:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].ACTI_PROD_DESC+'</textarea></div>'
					+'<div class="mui-input-row"><label>营销活动目的:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].MKT_ACTI_AIM+'</textarea></div>'
					+'<div class="mui-input-row"><label>备注:</label><textarea type="text" class="mui-input-clear" readonly="readonly">'+data[0].ACTI_REMARK+'</textarea></div></form>';
				},
				error:function(){
					plus.nativeUI.closeWaiting();
					mui.alert('加载失败！');
				}
			});
		}
		
		//修改后详情页面刷新
		window.addEventListener('backEvent__',function(event){
			//获得事件参数
			var id = event.detail.id;
			condition = {id:id};
			ajaxRequest();
		});
			
		mui('.mui-bar').on('tap','a.mui-action-back',function(){
			if(backPage != null){
			  	mui.fire(backPage,'paramBackEvent__',{
				});	
		    }
		});
	</script>
</html>