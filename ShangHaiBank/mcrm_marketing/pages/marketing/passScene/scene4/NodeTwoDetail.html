<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>Test</title>
		<script type="text/javascript" src="../../../common/AppBooter.js"></script>
		<script src="getNodeDetail.js"></script>
			<script src="../../../public/commTool/AppShare.js"></script>
		<script src="../../../../../resource/mui/js/mui.picker.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../../../../../resource/mui/css/mui.picker.min.css" />
	</head>
	<style>
		#switchBtnId2 {
			position: absolute;
			top: 13px;
			right: 15px;
		}
		
		#popover>button {
			width: 80px;
			float: left;
			margin-left: 30px;
			margin-top: 60px;
			background-color: #ff713c;
			;
			border-radius: 5px;
			color: #fff;
		}
		
		#popover>span {
			font-size: 24px;
			color: #D3D3D3;
			position: fixed;
			right: 65px;
		}
		.tgPng {
			float: right;
			width: 30px;
			margin-top: 7px;
			display: none;
		}
		.gxtg {
			width: 100%;
			height: 120%;
			margin-top: -68px;
			display: block;
			opacity: 0.1;
		}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class=" mui-icon mui-action-back mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">2日程安排</h1>
		
			<div class="tgPng" id="finishId"><img src="../tg.png" id="finishId" style="width: 100%;" ></img></div>
			<div class="tgPng" id="nextPass"><img src="../tg.png"  style="width: 100%;" ></img></div>
			<div class="tgPng" id="nextPass2"><img src="../tg.png" style="width: 100%;" ></img></div>
			<!--<a class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" id="finishId" style="display: none;color: #666;">过关</a>
			<a class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" id="nextPass" style="display: none;color: #666;">继续闯关</a>
			<a class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" id="nextPass2" style="display: none;color: #666;">继续闯关</a>-->
		</header>
		<div class="mui-content dark-bg">
			<div class="an-state" id="anStateDivId" style="display: none;"></div>
			<div class="mui-scroll-wrapper mui-nofootscroll an-min-wrapper">
				<div class="mui-scroll">
					<div class="an-Box" id="stepDiv">
						<img id="anBg" src="../../../../themes/common/images/game/pic_05_2.jpg" style="width: 100%;" />
						<div class="an-node ing" style="left: 58%;top: 83%;" onclick="">1</div>
						<div class="an-node " style="left: 45%;top: 69%;" onclick="">2</div>
						<div class="an-node" style="left: 50%;top: 60%;" onclick="">3</div>
					</div>
				</div>
			</div>
			<div class="mui-scroll-wrapper an-form-wrapper">
				<div class="mui-scroll" id="divId">
					<form id="addShceduleForm" action="" method="get">

						<ul class="mui-table-view mui-table-view-group">
							<li class="mui-table-view-cell" style="height:6em;">
								<textarea id="schTitle" type="text" class="mui-input-clear borderCss" placeholder="日程标题"></textarea>

							</li>
						</ul>
						<ul class="mui-table-view mui-table-view-group">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right mytime" data-options='{}'>
									<span class="mui-icon icon-clock"></span> 开始时间&nbsp;&nbsp;&nbsp;&nbsp;
									<span id="startTime">
									      
									    </span>
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right mytime" data-options='{}'>
									<span class="mui-icon icon-bell"></span> 结束时间&nbsp;&nbsp;&nbsp;&nbsp;
									<span id="endTime">
									
							    </span>
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" id="visitP">
									<span class="mui-icon icon-man"></span> 参与 &nbsp;&nbsp;&nbsp;&nbsp;
									<span id="parter">
								</span>
								</a>
							</li>
						</ul>
						<ul class="mui-table-view mui-table-view-group">
							<li class="mui-table-view-cell">
								<a id="addrTmp">
									<span class="mui-icon icon-location2"></span> 地点 &nbsp;&nbsp;&nbsp;&nbsp;
									<span id="addr">
								</span>

								</a>
							</li>
						</ul>

						<ul class="mui-table-view mui-table-view-group">
							<li class="mui-table-view-cell">
								<a>
									<span class="mui-icon icon-exit"></span> 重要
									<div id="isKey" style="display:none;">1</div>
									<div class="mui-switch mui-switch-blue mui-active" style="float: left;" id="switchBtnId" onClick="changeStatus();">
										<div class="mui-switch-handle"></div>
									</div>
									<div id="switchBtnId2"></div>

								</a>
							</li>
						</ul>

					</form>
				</div>
			</div>
		</div>
		<div class="myShade" style="opacity: 0.5;width: 100%;height: 100%;background-color:black;z-index: 99;position: absolute;top: 0px;display: none;"></div>
		<div class="popDiv" style="display: none;">
			<img id="ballon" src="../1.png" style="width: 90%;z-index: 100;position: absolute;top: 100px;left: 5%;" />
			<div style="position: absolute;left: 84px;top:380px;z-index: 100;width: 85px;"><img src="../b.png" style="width: 100%;" class="share" onclick="doShare()" /></div>
			<div id="nextLevel" style="position: absolute;right: 84px;z-index: 100;top: 380px;width: 85px;"><img src="../l.png" style="width: 100%;" /></div>
		</div>
		<!--<div id="popover" class="mui-popover" style="width: 250px;height: 200px;float: left;margin-left: 60.5px;margin-top: 150px;">
			<span class="icon-cancel-circle"></span>
			<div style="margin:0px auto;;color: #ff713c;text-align: center;line-height: 90px;font-size:18px">恭喜你，通过此关卡！</div>
			<button>分享</button>
			<button id="nextLevel">下一关</button>
		</div>-->
	</body>
	<script src="NodeTwoDetail.js"></script>
	<script src="../myShade.js"></script>
	<script>
		var _h = document.getElementById('anBg').clientHeight - document.getElementsByClassName('an-min-wrapper')[0].clientHeight;
		mui('.an-min-wrapper').scroll({
			startY: -(_h - 50)
		}); //
		mui('.an-form-wrapper').scroll();
		document.querySelector('.myShade').addEventListener('tap', function() {
			closeShade();
			mui.back();
		});
		document.querySelector('#ballon').addEventListener('tap', function() {
			closeShade();
			mui.back();
		})
		var currentId;
		var currentId; //当前视图Id；
		//		var activeId =  _App.util.getUrlParamByName("activeId"); //父页面Id  
		mui.plusReady(function() {

			currentId = plus.webview.currentWebview().id;
			nowData = plus.storage.getItem('nowData');
			if(nowData != null) {
				//表示从主界面过来的
				var data = JSON.parse(nowData);
				showStep(data); //显示图片步骤信息	
			} else {
				//使用ajax请求服务端，
				getSceneFlowMes();
			}
			//初始化 右上角的按钮
			if(cmap == null) {
				//已经通关

			} else if(cmap.STEP == "2" && cmap.FINISH_FLAG == "0") {
				//正在进行此关卡
				mui('.an-Box').on('tap', '.an-node.ing', function() {
					var title = document.querySelector('.mui-title').innerHTML;
					if(title != "2日程安排") {
						plus.webview.currentWebview().reload();
					}
				});
				document.getElementById('finishId').style.display = "block";
			} else {
				//当前关卡已完成
				mui('.an-Box').on('tap', '.an-node.ing', function() {
					var step = this.innerText.replace(/[^0-9]/ig, "");
					if(step == "3") {
						plus.storage.removeItem('nowData');
						var url = "NodeThreeDetail.html?passId=" + passId + "&recordId=" + recordId + "&activeId=" + activeId + "&needClose=" + currentId;
						_App.util.goPage(url, {
							pageId: "NodeThreeDetail_id",
							refresh: true
						});
					}
				});
				document.getElementById('nextPass').style.display = "block";
			}
			var addr = document.getElementById("addr");
			if(finish == "1") {
				//已经通关 显示详情
				getDetailByRefId(activityRefId);
			} else {
				document.getElementById('switchBtnId').style.display = "block"; //显示活动按钮
				//				document.getElementById('senLogId').setAttribute('style','color: #666;display:block');//显示 完成按钮
				getUserInfo(); //获取被拜访人信息
				getAddr();
				//时间选择
				(function($) {
					$.init();
					var btns = $('.mytime');
					btns.each(function(i, btn) {
						btn.addEventListener('tap', function() {
							var optionsJson = this.getAttribute('data-options') || '{}';
							var options = JSON.parse(optionsJson);
							var s = document.getElementById(this.children[1].id);
							var picker = new $.DtPicker(options);
							picker.show(function(rs) {
								s.innerHTML = rs.text;
								picker.dispose();
							});
						}, false);
					});
				})(mui);
			}

			var need = plus.webview.getWebviewById(needClose);
			if(need) {
				need.close();
			}

		});

		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		mui('.mui-scroll-wrapper').scroll();
		var backPage;

		function plusReady() {
			backPage = plus.webview.getWebviewById("calendar_id");
		}

		document.getElementById("finishId").addEventListener('tap', function() {
			saveScheduleInfo('addShceduleForm');
		});

		var dataStr = "";
		var timeStr = "";
		// H5 plus事件处理

		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		/**
		 *调用设备获取地址 
		 */
		function getAddr() {
			plus.geolocation.getCurrentPosition(function(p) {
					if(!p.addresses) {
						mui.alert('定位失败，请检查相关设备!', '提示', function() {
							plus.webview.currentWebview().close();
						});
					} else {
						addr.innerHTML = p.address.province + p.address.district + p.address.street;
						longitude = p.coords.longitude;
						latitude = p.coords.latitude;
					}

				}, function(e) {
					plus.webview.currentWebview().close();
				}
				//			, {
				//				provider: 'baidu'
				//			}
			);
		}
	</script>

</html>