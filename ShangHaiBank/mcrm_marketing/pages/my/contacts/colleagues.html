<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>通讯录</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--公共js-->
		<script src="../../common/AppBooter.js"></script>
		<link href="../../../../resource/mui/css/mui.indexedlist.css" rel="stylesheet" />
		<style>
			html,
			body {
				height: 100%;
				overflow: hidden;
			}
			
			.phone-right {
				float: right;
			}
			
			.ys-accNode>b.icon-radio-unchecked {
				margin-right: 20px;
				margin-top: 10px;
			}
			
			#switchBtn,
			#defaultBtn {
				bottom: 40px;
			}
			
			.moreDiv {
				width: 35%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-back mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<a class="mui-back icon-line-58 mui-icon mui-icon-right-nav mui-pull-right" href="#more"></a>
			<h1 class="mui-title">联系人</h1>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item mui-active" data-fn="" href="#fff">消息</a>
					<a class="mui-control-item" data-fn="getOrgData()" href="#msiByOrg">通讯录</a>
					<!--<a class="mui-control-item " id="commonBt" data-fn="getCommon()" href="#msiOften">常用</a>
					<a class="mui-control-item" id="indexBt" data-fn="getIndexDatas()" href="#item3mobile">索引</a>-->
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
				<div class="mui-slider-group dark-bg">
					<div id="fff" class="mui-slider-item mui-control-content mui-active">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="ys-message ys-msg">
									<div class="ys-break ys-anContent">
										<div class="alertMsg"><b class="icon-line-20"></b></div>消息通知<br><i class="break">对公贷款余额环比增长30%</i><span class="mui-time mui-icon" ;>10:35</span></div>
								</div>
								<div class="ys-message ys-msg">
									<div class="ys-break ys-anContent">
										<div class="alert-group alertMsg"><b class="icon-line-9"></b></div>
										</b>西南片区分行<br><i class="break">李四：报表已发你邮箱</i><span class="mui-time mui-icon" ;>12:25</span></div>
								</div>
								<div class="ys-message ys-msg">
									<div class="ys-break ys-anContent">
										<div class="alert-group alertMsg"><b class="icon-line-9"></b></div>
										</b>您有六笔大额变动<br><i class="break">广西航桂实业有限公司</i><span class="mui-time mui-icon" ;>16:25</span></div>
								</div>
								<div class="ys-message ys-msg">
									<div class="ys-break ys-anContent">
										<div class="alert-group alertMsg"><b class="icon-line-9"></b></div>
										</b>您有两个公告提醒<br><i class="break">营销产品营销会</i><span class="mui-time mui-icon" ;>16:25</span></div>
								</div>
								<div class="ys-message ys-msg" onclick="goChat('刘成')">
									<div class="ys-break ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>刘成<br><i class="break">很好！</i><span class="mui-time mui-icon" ;>昨天</span></div>
								</div>
							</div>
						</div>
					</div>

					<div id="msiByOrg" class="mui-slider-item mui-control-content dark-bg">
						<div class="mui-scroll-wrapper" style="display: block;" id="defaultDiv">

							<div class="mui-scroll">
								<div class="mboSearch">
									<input type="text" class="txtSearch" placeholder="输入关键字查找同事…" />
									<span class="mui-icon mui-icon-search"></span>
								</div>
								<div id="colAcd1" class="ys-accordion marBtm">
									<div class="ys-accContent">
										<div class="ys-accNode"><span>常用</span></div>
										<div class="ys-accContent">
											<div class="ys-accNode" data-fn="makeTalk('lizongjian');">
												<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>李宗建<i>总行部门领导</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
											</div>
											<a href="tel:18030878861" id="telId"></a>
										</div>
									</div>
								</div>

								<div id="colAcd2" class="ys-accordion marBtm">
									<div class="ys-accContent">
										<div class="ys-accNode"><span>工作群</span></div>
										<div class="ys-accContent">
											<div class="ys-accNode" data-fn="makeTalk('lizongjian');">
												<div class="ys-anContent"><b><div class="alert-group alertMsg"><b class="icon-line-9"></b></div>
												</b>张晶力、张有可、王兑章<i></i></div>
										</div>
									</div>
								</div>
							</div>

							<div id="colAcd3" class="ys-accordion ">
								<div class="ys-accContent">
									<div class="ys-accNode"><span>总行</span></div>
									<div class="ys-accContent">
										<div class="ys-accNode" data-fn="makeTalk('lizongjian');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>李宗建<i>总行部门领导</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<a href="tel:18030878861" id="telId"></a>
									</div>
									<div class="ys-accNode /*ys-accnOpen*/"><span>北京分行</span></div>
									<div class="ys-accContent">
										<div class="ys-accNode" data-fn="makeTalk('wangduizhang');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_02.gif" alt="" /></b>王兑章<i>分行团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<div class="ys-accNode" data-fn="makeTalk('zhangjingli');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>张晶丽<i>分行客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<div class="ys-accNode" data-fn="makeTalk('caijinli');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_04.gif" alt="" /></b>蔡金力<i>分行产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<a href="tel:18030878861" id="telId"></a>
									</div>
									<div class="ys-accNode"><span>上海分行</span></div>
									<div class="ys-accContent">
										<div class="ys-accNode" data-fn="makeTalk('张可有');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_05.gif" alt="" /></b>张可有<i>事业部团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<div class="ys-accNode" data-fn="makeTalk('李双');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_06.gif" alt="" /></b>李双<i>事业客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<div class="ys-accNode" data-fn="makeTalk('吴明');">
											<div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>吴明<i>事业产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div>
										</div>
										<a href="tel:18030878861" id="telId"></a>
									</div>
								</div>
							</div>
						</div>
						<div id="defaultBtn" class="switchButton icon-line-125"></div>
					</div>
					<div id="switchDiv" style="display: none;">
						<div class="switchButton switchButton icon-line-119" id="switchBtn"></div>
						<div id='list' class="mui-indexed-list">
							<div class="mui-indexed-list-search mui-input-row mui-search">
								<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="搜索">
							</div>
							<div class="mui-indexed-list-bar">
								<a>A</a>
								<a>B</a>
								<a>C</a>
								<a>D</a>
								<a>E</a>
								<a>F</a>
								<a>G</a>
								<a>H</a>
								<a>I</a>
								<a>J</a>
								<a>K</a>
								<a>L</a>
								<a>M</a>
								<a>N</a>
								<a>O</a>
								<a>P</a>
								<a>Q</a>
								<a>R</a>
								<a>S</a>
								<a>T</a>
								<a>U</a>
								<a>V</a>
								<a>W</a>
								<a>X</a>
								<a>Y</a>
								<a>Z</a>
							</div>
							<div class="mui-indexed-list-alert"></div>
							<div class="mui-indexed-list-inner" id='indexAbListId'>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<div class="mui-popover moreDiv" id="more">
			<ul class="mui-table-view ">
				<li class="mui-table-view-cell">
					<a><span class="icon-line-18" /> 添加联系人</a>
				</li>
				<li class="mui-table-view-cell">
					<a><span class="icon-bubbles4" /> 发起群聊</a>
				</li>
				<li class="mui-table-view-cell">
					<a><span class="icon-line-92" /> 扫一扫</a>
				</li>
			</ul>
		</div>
		</div>
	</body>
	<script src="../../../../resource/mui/js/mui.indexedlist.js"></script>
	<script src="chatRecordData.js"></script>
	<script src="colleagues.js"></script>
	<script src="data.js"></script>
	<script>
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		var subTab = _App.util.getUrlParamByName("subTab");
		//让通讯录选中
		if(subTab == 2) {
			var tabs = document.getElementById('slider').querySelectorAll('.mui-control-item');
			tabs[0].classList.remove('mui-active');
			document.getElementById('fff').classList.remove('mui-active');
			tabs[1].classList.add('mui-active');
			document.getElementById('msiByOrg').classList.add('mui-active');
		}

		(function($) {
			//自适应高度
			//			var _header = document.querySelector('header.mui-bar');
			//			var _slider = document.querySelector('div.mui-slider-indicator');
			//			var _h = (document.body.offsetHeight - _header.offsetHeight - _slider.offsetHeight) + 'px';
			//			document.getElementById("msiByOrg").style.height = _h;
			//			document.getElementById("msiOften").style.height = _h;
			//			document.getElementById("item3mobile").style.height = _h;
			pageHeightInit();
			//Accordion 

			YSUI.Accordion("colAcd1");
			YSUI.Accordion("colAcd2");
			YSUI.Accordion("colAcd3");
			//scroll
			$('.mui-scroll-wrapper').scroll();
		})(mui);
		//如何是分享页面-通讯录
		var news = _App.util.getUrlParamByName('news');
		mui.ready(function() {
			var header = document.querySelector('header.mui-bar');
			indexedElmtId = document.getElementById('list');
			//calc hieght
			indexedElmtId.style.height = (document.body.offsetHeight - header.offsetHeight-30) + 'px';
			//create
			indexedObj = window.indexedList = new mui.IndexedList(indexedElmtId);
		});
		mui('#colAcd1').on('tap', '.ys-accNode', function() {
			eval(this.getAttribute('data-fn'));
		});
		mui('#colAcd2').on('tap', '.ys-accNode', function() {
			eval(this.getAttribute('data-fn'));
		});
		mui('#colAcd3').on('tap', '.ys-accNode', function() {
			eval(this.getAttribute('data-fn'));
		});
		
		mui('#indexAbListId').on('tap','li', function() {
			eval(this.getAttribute('data-fn'));
		});


		function makeTelephone(obj) {
			//				var obj = mui("#"+obj)[0];
			//				obj.click();
			plus.device.dial('18030878861', false);
		}
		var accountName = "";
		mui.plusReady(function() {
			accountName = plus.storage.getItem("accountName");
			//			getOrg(); //初始化 机构数据

			document.getElementById('defaultBtn').addEventListener('tap', function() {
				plus.nativeUI.showWaiting('正在切换中...');
				document.getElementById('defaultDiv').style.display = "none";
				document.getElementById('switchDiv').style.display = "block";
				getIndexDatas();
				var _h = document.querySelector('.mui-indexed-list-search').offsetHeight;
				var aHeight = document.getElementById('msiByOrg').offsetHeight - _h;
				aHeight = aHeight / 27;
				var aList = mui('.mui-indexed-list-bar a');
				for(var m = 0; m < aList.length; m++) {
					aList[m].style.height = aHeight + "px";
				}
				plus.nativeUI.closeWaiting();
			});

			document.getElementById('switchBtn').addEventListener('tap', function() {
				plus.nativeUI.showWaiting('正在切换中...');
				document.getElementById('defaultDiv').style.display = "block";
				document.getElementById('switchDiv').style.display = "none";
				plus.nativeUI.closeWaiting();
			});
			//			
			//

		});

		function swiptListener() {
			var tran = document.getElementById('sliderProgressBar').style.webkitTransform;
			//			console.log(tran);
			var _width = document.getElementById('sliderProgressBar').scrollWidth;
			//			console.log(tran);
			//			console.log('一个条的宽度是：'+_width);

			var k = tran.indexOf('(') + 1; //去掉括号
			var d = tran.indexOf(',') - 2; //去掉px
			//			 console.log('k:'+k+'  d:'+d);
			var tranX = tran.substring(k, d);
			//			 alert(tran.substring(k,d));
			//			console.log('tranX:'+tranX);
			//滑动到第一个
			if(tranX <= (0.5 * _width)) {
				getOrgData();
			}
			//滑动到第二个
			else if((0.5 * _width) < tranX && tranX < (_width * 1.5)) {
				getCommon();
			} else {
				getIndexDatas();
			}
		}
		document.addEventListener('touchend', function() {
				//			setTimeout(swiptListener, 200);//解决在滑动太快的某一种情况  css还没有变化  监听就已经执行了

			})
			//		document.getElementById('commonBt').addEventListener('tap', function() {
			//			getCommon();
			//		});
			//		document.getElementById('indexBt').addEventListener('tap', function() {
			//			getIndexDatas(); //初始化索引数据
			//		});

		function addChatRoomMembers(data, toName) {
			var roomId = data.roomid;
			var roomName = data.roomname;
			var roomType = data.roomtype;
			var paras = [];
			var peo = {
				roomId: roomId,
				peopleName: toName
			};
			paras.push(peo);
			peo = {
				roomId: roomId,
				peopleName: accountName
			};
			paras.push(peo);
			var data_ = {
				para: JSON.stringify(paras)
			};
			_App.ajax({
				type: "get",
				url: basePath + 'chat!addChatRoomMembers.json',
				data: data_,
				cache: false,
				dataType: "json",
				success: function(response) {
					//判断是不是从分享页面跳转过来的
					if(news == 1) {
						var details = plus.webview.getWebviewById('share_list');
						mui.fire(details, 'share_list', {
							id: 1
						});
						plus.webview.getWebviewById('myPage').close();
					} else {
						//跳转到聊天组界面
						var url = "../../public/chat/im-chat.html?chatRoomId=" + roomId + "&chatRoomName=" + encodeURIComponent(roomName) + "&createRoomPeo=" + accountName + "&type=" + roomType;
						_App.util.goPage(url, {
							pageId: 'im-chat-id', //viewId可以通过plus.webview.getWebviewById('view001');取到
							refresh: false //是否刷新viewId为view001的webview
						});
					}
				},
				error: function(a, b, c) {
					mui.alert("网络连接出错!");
				}
			});
		}

		var goChat = function(name) {
				_App.util.goPage("chat.html?toName=" + encodeURIComponent(name), "none");

			}
			//扫一扫
		var go2Scan = function() {
			_App.util.goPage('../barcode/barcode.html', {
				pageId: 'scanId',
				refresh: false
			});
		}
	</script>

</html>