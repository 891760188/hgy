<!DOCTYPE html>
<html>
	 <head>
		<meta charset="utf-8">
		<title>日程</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script src="../../common/AppBooter.js"></script>
		<link rel="stylesheet" href="../../../../resource/calendar/style/documentation.css" type="text/css" />
		<link rel="stylesheet" href="../../../../resource/calendar/style/jalendar.css" type="text/css" />
		<script type="text/javascript" src="../../../../resource/calendar/js/jquery-1.10.2.min.js"></script><!--jQuery-->
		<script type="text/javascript" src="../../../../resource/calendar/js/jalendar.js"></script>
		<!--<script type="text/javascript" charset="utf-8"	src="../../../../resource/fastclick/fastclick.js"></script>-->
		<script type="text/javascript" charset="utf-8"	src="calendar.js"></script>
		
		<style type="text/css">
			.showKeyFlag_0{display:none;}
			.showKeyFlag_1{display:inline;}
			.sup_state_0{
			  	color:orange;
			}
			.selectDateList{
				width:33%;float:left;align-content: center;margin-top:10px;
			}
			.mui-table-view-cell>a:not(.mui-btn){padding:10px 30px;}
			.mui-table-view-cell{padding: 11px 0 0;}
			.bottom-prompt {
				bottom: 0;
				width: 100%;
				padding: 10px;
				border-radius: 0;
				height: 62px;
			}
			
			.bottom-prompt>textarea {
				float: left;
				width: calc(100% - 80px);
				border-radius: 3px;
				border-bottom-right-radius: 0;
				border-top-right-radius: 0;
				height: 42px;
				border: 1px #e6e7e8 solid;
				padding: 10px 8px 8px 8px;
				line-height: 20px;
				overflow: auto;
				overflow-x: hidden;
				font-size: 14px;
			}
			
			.bottom-prompt>input[type=button] {
				float: left;
				width: 80px;
				border-bottom-left-radius: 0;
				border-top-left-radius: 0;
				height: 42px;
				border-left: 0;
				border-color: #e6e7e8;
				color: #ea5404;
			}
			.iconBlue{
				color: #4896cd!important;
			}
			.mui-table-view-cell-bt>button{ width: calc(100%/4);}
			.mui-bar .mui-icon.mui-pull-right{
				font-size: 18px;
				top: 3px;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav"> 
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">日程</h1>
			<a id="senLogId" class="mui-icon icon-plus mui-pull-right"></a>
		</header>
		
		<div class="mui-content dark-bg">
			<div id="pullrefresh" class="mui-scroll-wrapper mui-nofootscroll">
				<div class="mui-scroll" >
					<div id="myId" class="jalendar"> 
			        	
					</div>
					
					<div id="ulId">
						<!--<ul class="mui-table-view mui-table-view-group">
						<li class="mui-table-view-cell" id="li_'+scdId+'">
                
				               <a class="mui-navigate-right">
				               <b class="tagTips c1 showKeyFlag_'+isKey+'">重要</b>
				               <p>时间：</p>
				                </a>
				                
								<div class="mui-table-view-cell-bt find-button">
								<button class="icon-bubble3" data-val="'+scdId+'" id="comm_'+scdId+'">评论</button>
								<button class="icon-like sup_state_'+isSup+'" data-issup="'+isSup+'" id="sup_'+scdId+'">赞</button>
								<button class="icon-heart" data-issup="'+focCount+'" id="foc_'+scdId+'">关注</button>
								</div>
								</li>
								</ul>-->
						
					</div>
				
					<a class="addCalendar icon-plus" onclick="goAddEventPage()">新建日程</a>
				</div>
			</div>
		</div>
		<!--<div id="popover2" class="mui-popover" style="width:99%;height:45%;margin-bottom:10px;bottom:0px;">
			
			<textarea style="width:99%;height:60%;" id="commonTent" cols="50" rows="5" placeholder="输入评论内容，不超过500字"></textarea>

			<div style="text-align: center;height:30%;">
				<button type="button" class="mui-btn mui-btn-danger" onclick="commonSale();">提交</button>
				<button type="button" class="mui-btn mui-btn-danger" onclick="cancelSale();">取消</button>
			</div>
		</div>-->
		
		<div id="popover2" class="mui-popover bottom-prompt" >
				<div  id="commTitle"></div>
				<textarea  id="commonTent" cols="50" rows="5" placeholder="输入评论内容..."></textarea>
				<input type="button" value="提交" id="commContentButId" onclick="commonSale();"/>
		 </div>
		
		<div id="popover3" class="mui-popover" style="width:80%;height:30%;margin-top:50px;left:10%;">

			<ul class="mui-table-view" style="text-align: center;height:70%;">
				<li class="mui-table-view-cell msl-menu" id="li_data_select">
				</li>
			</ul>

			<div style="text-align: center;height:30%;">
				<button type="button" class="mui-btn mui-btn-danger" onclick="preYearSelect();">&lt&lt</button>
				<button type="button" class="mui-btn mui-btn-danger" onclick="nextYearSelect();">&gt&gt</button>
			</div>
			
		</div>
	</body>
	<script>
		mui.init({
			swipeBack:false //启用右滑关闭功能
		});
		mui('.mui-scroll-wrapper').scroll();
		$(document).ready(function(){
			//初始化日历
            initSchedule(getCurrDateStr(0,'/'));
		    
			$('#myId').jalendar({
		        customDay: getCurrDateStr(0,'/'),  // Format: Year/Month/Day
		        color: '#ea5404', // Unlimited Colors
		        lang: 'ZH-CN' // Format: English — 'EN', Chinese-'ZH-CN'
		    });

		    //更新数据
		    $('#myId').on('tap', '.day', function(){
            	var currDay = $(this).attr('data-date');
            	var condition = {};
				condition.currDay = getCurrDateStr(6,'',currDay);
				initSchList(condition);
            	
            });

		});
		function goAddEventPage(){
			var href = "addSchedule.html";
			_App.util.goPage(href, {
				pageId:'work/addSchedule.html', //viewId可以通过plus.webview.getWebviewById('addSceduleViewId');取到
				refresh: true   //是否刷新viewId为addSceduleViewId的webview
			});
		}
		document.getElementById("senLogId").addEventListener('tap',function(){
			goAddEventPage();
		})
		
		document.getElementById('myId').addEventListener('swipeleft',function(){
			document.getElementsByClassName('nxt-m')[0].click();
		});
		document.getElementById('myId').addEventListener('swiperight',function(){
			document.getElementsByClassName('prv-m')[0].click();
		});
		
		//保存后返回刷新
		window.addEventListener('paramBackEvent__',function(event){
			 //var name = event.detail.name;
		     
		    document.getElementById("myId").innerHTML = "";
		     //初始化日历
            initSchedule(getCurrDateStr(0,'/'));
		    
			$('#myId').jalendar({
		        customDay: getCurrDateStr(0,'/'),  // Format: Year/Month/Day
		        color: '#ea5404', // Unlimited Colors
		        lang: 'ZH-CN' // Format: English — 'EN', Chinese-'ZH-CN'
		    });

		    //更新数据
		    $('#myId').on('tap', '.day', function(){
            	var currDay = $(this).attr('data-date');
            	var condition = {};
				condition.currDay = getCurrDateStr(6,'',currDay);
				
				initSchList(condition);
            	
            });
            
            //初始化当前日期日程数据
            var condition = {};
			condition.currDay = getCurrDateStr(0,'-');
			initSchList(condition);
		});
	
	  //详情页面更新后刷新页面
	  window.addEventListener('BACK_REFRESH_EVENT_',function(event){
	  	  var type = event.detail.type;
	  	  var val = event.detail.val;
	  	  var recId = event.detail.recId;
	  	  var flag = event.detail.flag;
	  	  
	  	  var rObj = document.getElementById("li_"+recId);
	  	  var reObj = document.getElementById(type+recId);

	  	  if(undefined != rObj && undefined != reObj){
	  	  	  
	  	  	  if(type == "comm_"){
	  	  	     reObj.innerHTML = '评论('+val+')';
		  	  }else if(type== "sup_"){
		  	  	if(flag == "1"){//详情里面进行了点赞操作
		  	  		reObj.className = "icon-like sup_state_1";
		  	  	    reObj.setAttribute("data-issup","1");
		  	  	}else{//详情里面取消点赞
		  	  		
		  	  	    reObj.className = "icon-like sup_state_0";
		  	  	    reObj.setAttribute("data-issup","0");
		  	  	}
		  	  	
			    reObj.innerText = "赞("+val+")";
			    
		  	  }else if(type=="foc_"){
		  	  	if(flag == "1"){//详情里面进行了点赞操作
		  	  		if(val != "0"){
						reObj.setAttribute("style","color:orangered;border-color: orangered;");
						reObj.innerHTML = '取消';
					}
		  	  	}else{//详情里面取消点赞
					if(val == "0"){
						reObj.setAttribute("style","");
						reObj.innerHTML = '关注';
					}

		  	  	}
		  	  	
		  	  	 reObj.setAttribute("data-issup",val);
		  	  }
	  	  }
	  	  
	  });
		
	  function plusReady(){
  			currentViewId=plus.webview.currentWebview().id;
	  	//初始化当前日期日程数据
            var condition = {};
			condition.currDay = getCurrDateStr(0,'-');
			initSchList(condition);
			initPreAndNextEvent();
			//分享
			mui('#ulId').on('tap','.mui-table-view-cell-bt>.share',function(){
				var bizId = this.getAttribute('id').replace(/[^0-9]/ig,'');
				doShare(bizId);
			});
		
		}
		if(window.plus){
			plusReady();
		}else{
			document.addEventListener("plusready",plusReady,false);
		}

		function cancelSale() {
			var obj = mui("#commonTent")[0];
			obj.value = "";
			mui('#popover2').popover('toggle');
		}
	</script>
</html>
