<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>新建日志</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript" src="../../common/AppBooter.js"></script>
		<script src="../../public/commTool/antCharacterTool.js"></script>
		<script type="text/javascript" src="addLog.js"></script>

	</head>
	<style type="text/css">
		.mui-input-row label {
			width: 65px;
			padding-top: 12px;
		}
		
		.mui-input-row label~input {
			width: calc(100% - 65px);
		}
		#senLogId{
			color: #666;
		}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" id="muiTitleId">新建日志</h1>
			<a id="senLogId" class="mmui-btn mui-btn-blue mui-btn-link mui-pull-right">保存</a>
		</header>
		<div class="mui-content dark-bg">
			<div class="mui-scroll-wrapper mui-nofootscroll">
				<div class="mui-scroll">

					<div>
						<!--<form class="mui-input-group">
	                    	<div class="mui-input-row">
								<label>标题：</label>
								<input id="logTitle" type="text" placeholder="日志标题">
							</div>
						</form> -->
						<textarea id="logContent" type="text" class="mui-input-clear" placeholder="日志内容…" style="height:30em;line-height: 30px;">
今日工作： 							
1、 
2、 
3、 
明日计划： 
1、 
2、
3、
						</textarea>

					</div>

				</div>
			</div>
		</div>

	</body>
	<script>
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		mui('.mui-scroll-wrapper').scroll();
		var backPage;

		function plusReady() {
			currentViewId = plus.webview.currentWebview().id;
			backPage = plus.webview.getWebviewById("logList.html");
			document.querySelector("#logContent").addEventListener('input',function(){
				//随时检索是否有@符号
				var _s = this.value;
				_s = _s.split(" ").join("</br>");
//				console.log("_s==="+_s);
//				console.log("tt_>>>>>>>"+tt_);
				if(antInputCount == 0){//开始，值一样
					midAntValue = _s;
					oldAntValue = _s;
				}else if(antInputCount == 1){//第一次变化
					midAntValue = _s;
				}else if(antInputCount > 1){//第n次变化
					oldAntValue = midAntValue;//保持了上一次的值
					midAntValue = _s;
				}
				
				
				var rmap = reloadStorage(antStorage,_s,chooseUserNamesStorage,oldAntValue);
				if(rmap){
					_s = rmap.content;
					antStorage = rmap.list;
					chooseUserNamesStorage = rmap.cunStorage;
					var oldContent = rmap.oldContent;
					if(oldContent){
						midAntValue = oldAntValue = oldContent;
					}
					_s = _s.split("</br>").join(" ");
					document.getElementById("logContent").value = _s;
					//测试用，查看下antStorage
					for(var i = 0; i < antStorage.length; i++){
						var m = antStorage[i];
					}
				}
				//必须判断是否需要选择@人员
				if(isGo2AntChoose(_s)){
					var pageViewId = encodeURIComponent(currentViewId);
					var url = "../../SocialCol/contacts/colleagues.html?dataFnType=radio&pageVeiwId=" + pageViewId;
					_App.util.goPage(url, {
						pageId: 'colleagues-id',
						refresh: true
					});
				}else{//每次都需要重新组装antStorage
					antInputCount += 1;
				}
			});
		}
		if (window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		document.getElementById("senLogId").addEventListener('tap', function() {
			saveLogInfo();
		})
	</script>

</html>