<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>通讯录</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--公共js-->
		<script src="../../common/AppBooter.js"></script>
		<link href="../../../../resource/mui/css/mui.indexedlist.css" rel="stylesheet" />
		<style>
			html,
			body {
				height: 100%;
				overflow: hidden;
			}
			
			.phone-right {
				float: right;
			}
			
			.ys-accNode>b.icon-radio-unchecked {
				margin-right: 20px;
				margin-top: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">通讯录</h1>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted dark-bg">
					<a class="mui-control-item mui-active" data-fn="getOrgData()" href="#msiByOrg">按机构</a>
					<a class="mui-control-item " id="commonBt" data-fn="getCommon()" href="#msiOften">常用</a>
					<a class="mui-control-item" id="indexBt" data-fn="getIndexDatas()" href="#item3mobile">索引</a>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
				<div class="mui-slider-group">
					<div id="msiByOrg" class="mui-slider-item mui-control-content mui-active dark-bg">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="mboSearch dark-input">
									<input type="text" class="txtSearch" placeholder="输入关键字查找同事…" />
									<span class="mui-icon mui-icon-search"></span>
								</div>
								<div id="colAcd" class="ys-accordion">
									<!--<div class="ys-accContent">-->
									<!--<div class="ys-accNode"><span>总行</span></div>   
										<div class="ys-accContent">
											<div class="ys-accNode"  data-fn="makeTalk('lizongjian');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>李宗建<i>总行部门领导</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										    <a href="tel:13800138000" id="telId"></a>
										</div>
										<div class="ys-accNode /*ys-accnOpen*/"><span>分行</span></div>
										<div class="ys-accContent">
											<div class="ys-accNode"  data-fn="makeTalk('wangduizhang');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>王兑章<i>分行团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
											<div class="ys-accNode" data-fn="makeTalk('zhangjingli');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_02.gif" alt="" /></b>张晶丽<i>分行客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
											<div class="ys-accNode" data-fn="makeTalk('caijinli');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>蔡金力<i>分行产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										    <a href="tel:13800138000" id="telId"></a>
										</div>
										<div class="ys-accNode"><span>能源矿产事业部</span></div>
										<div class="ys-accContent">
											<div class="ys-accNode"  data-fn="makeTalk('张可有');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>张可有<i>事业部团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
											<div class="ys-accNode" data-fn="makeTalk('李双');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_02.gif" alt="" /></b>李双<i>事业客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
											<div class="ys-accNode" data-fn="makeTalk('吴明');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>吴明<i>事业产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										    <a href="tel:13800138000" id="telId"></a>
										</div>-->
									<!--</div>-->
								</div>
							</div>
						</div>
					</div>
					<div id="msiOften" class="mui-slider-item mui-control-content dark-bg">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="mboSearch dark-input">
									<input type="text" class="txtSearch" placeholder="输入关键字查找同事…" />
									<span class="mui-icon mui-icon-search"></span>
								</div>
								<div class="ys-accordion" id="commonId">
									<!--<div class="ys-accContent">
										<div class="ys-accNode"  data-fn="makeTalk('李宗建');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>李宗建<i>总行部门领导</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode"  data-fn="makeTalk('王兑章');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>王兑章<i>分行团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode" data-fn="makeTalk('张晶丽');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_02.gif" alt="" /></b>张晶丽<i>分行客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode" data-fn="makeTalk('蔡金力');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>蔡金力<i>分行产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode"  data-fn="makeTalk('张可有');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_01.gif" alt="" /></b>张可有<i>事业部团队长</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode" data-fn="makeTalk('李双');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_02.gif" alt="" /></b>李双<i>事业客户经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<div class="ys-accNode" data-fn="makeTalk('吴明');"><div class="ys-anContent"><b><img src="../../../themes/default/images/temp/temp_03.gif" alt="" /></b>吴明<i>事业产品经理</i><span class="mui-icon mui-icon-phone" data-fn="makeTelephone('telId');"></span></div></div>
										<a href="tel:13800138000" id="telId"></a>
									</div>-->
								</div>
							</div>
						</div>

					</div>
					<div id="item3mobile" class="mui-slider-item mui-control-content">
						<div id='list' class="mui-indexed-list">
							<div class="mui-indexed-list-search mui-input-row mui-search">
								<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="搜索">
							</div>
							<div class="mui-indexed-list-bar">
								<a>A</a>
								<a>B</a>
								<a>C</a>
								<a>D</a>
								<a>E</a>
								<a>F</a>
								<a>G</a>
								<a>H</a>
								<a>I</a>
								<a>J</a>
								<a>K</a>
								<a>L</a>
								<a>M</a>
								<a>N</a>
								<a>O</a>
								<a>P</a>
								<a>Q</a>
								<a>R</a>
								<a>S</a>
								<a>T</a>
								<a>U</a>
								<a>V</a>
								<a>W</a>
								<a>X</a>
								<a>Y</a>
								<a>Z</a>
							</div>
							<div class="mui-indexed-list-alert"></div>
							<div class="mui-indexed-list-inner" id='indexAbListId'>
								<!--<div class="mui-indexed-list-empty-alert">没有数据</div>
								<ul class="mui-table-view" id="phoneCallUl">
									<a href="tel:13800138000" id="telId2"></a>
										<li data-group="A"  class="mui-table-view-divider mui-indexed-list-group">A</li>
										<li data-value="ANJ" data-fn="makeTalk('安杰');" data-tags="AnJie" class="mui-table-view-cell mui-indexed-list-item">安杰<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="AX" data-fn="makeTalk('艾雪');" data-tags="AiXue" class="mui-table-view-cell mui-indexed-list-item">艾雪<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="B" class="mui-table-view-divider mui-indexed-list-group">B</li>
										<li data-value="MKM" data-fn="makeTalk('鲍克明');" data-tags="BaoKeMing" class="mui-table-view-cell mui-indexed-list-item">鲍克明<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="BM" data-fn="makeTalk('包宁');" data-tags="BaoMing" class="mui-table-view-cell mui-indexed-list-item">包宁<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="C" class="mui-table-view-divider mui-indexed-list-group">C</li>
										<li data-value="CM" data-fn="makeTalk('蔡明');" data-tags="caiming" class="mui-table-view-cell mui-indexed-list-item">蔡明<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="D" class="mui-table-view-divider mui-indexed-list-group">D</li>
										<li data-value="DHJ" data-fn="makeTalk('杜海菊');" data-tags="DuHaiJu" class="mui-table-view-cell mui-indexed-list-item">杜海菊<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="E" class="mui-table-view-divider mui-indexed-list-group">E</li>
										<li data-value="EF" data-fn="makeTalk('呃飞');" data-tags="ErFei" class="mui-table-view-cell mui-indexed-list-item">呃飞<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="F" class="mui-table-view-divider mui-indexed-list-group">F</li>
										<li data-value="FHM" data-fn="makeTalk('方和明');" data-tags="FangHeMing" class="mui-table-view-cell mui-indexed-list-item">方和明<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="G" class="mui-table-view-divider mui-indexed-list-group">G</li>
										<li data-value="GM" data-fn="makeTalk('龚梅');" data-tags="GongMei" class="mui-table-view-cell mui-indexed-list-item">龚梅<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="GX" data-fn="makeTalk('郭襄');" data-tags="GuoXiang" class="mui-table-view-cell mui-indexed-list-item">郭襄<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-group="H" class="mui-table-view-divider mui-indexed-list-group">H</li>
										<li data-value="HY" data-fn="makeTalk('黄页');" data-tags="HuangYe" class="mui-table-view-cell mui-indexed-list-item">黄页<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="J" class="mui-table-view-divider mui-indexed-list-group">J</li>
										<li data-value="JMJ" data-fn="makeTalk('金铭决');" data-tags="JinMingjue" class="mui-table-view-cell mui-indexed-list-item">金铭决<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="K" class="mui-table-view-divider mui-indexed-list-group">K</li>
										<li data-value="KJT" data-fn="makeTalk('阚锦涛');" data-tags="KanJinTao" class="mui-table-view-cell mui-indexed-list-item">阚锦涛<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="L" class="mui-table-view-divider mui-indexed-list-group">L</li>
										<li data-value="LJC" data-fn="makeTalk('赖金成');" data-tags="LaiJinCheng" class="mui-table-view-cell mui-indexed-list-item">赖金成<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="LS" data-fn="makeTalk('李双');" data-tags="LiShuang" class="mui-table-view-cell mui-indexed-list-item">李双<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="LS" data-fn="makeTalk('李四');" data-tags="LaiSi" class="mui-table-view-cell mui-indexed-list-item">李四<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-group="M" class="mui-table-view-divider mui-indexed-list-group">M</li>
										<li data-value="MH" data-fn="makeTalk('苗红');" data-tags="Miaohong" class="mui-table-view-cell mui-indexed-list-item">苗红<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="N" class="mui-table-view-divider mui-indexed-list-group">N</li>
										<li data-value="NCM" data-fn="makeTalk('宁蔡明');" data-tags="NingCaiMing" class="mui-table-view-cell mui-indexed-list-item">宁蔡明<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="P" class="mui-table-view-divider mui-indexed-list-group">P</li>
										<li data-value="PF" data-fn="makeTalk('彭飞');" data-tags="PengFei" class="mui-table-view-cell mui-indexed-list-item">彭飞<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-group="Q" class="mui-table-view-divider mui-indexed-list-group">Q</li>
										<li data-value="QMJ" data-fn="makeTalk('钱明骏');" data-tags="QianMingJun" class="mui-table-view-cell mui-indexed-list-item">钱明骏<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="R" class="mui-table-view-divider mui-indexed-list-group">R</li>
										<li data-value="RX" data-fn="makeTalk('任雪');" data-tags="RENXUE" class="mui-table-view-cell mui-indexed-list-item">任雪<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-group="S" class="mui-table-view-divider mui-indexed-list-group">S</li>
										<li data-value="SF" data-fn="makeTalk('少飞');" data-tags="ShaoFei" class="mui-table-view-cell mui-indexed-list-item">少飞<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="T" class="mui-table-view-divider mui-indexed-list-group">T</li>
										<li data-value="TD" data-fn="makeTalk('唐丹');" data-tags="TangDan" class="mui-table-view-cell mui-indexed-list-item">唐丹<span class="mui-icon mui-icon-phone phone-right"></span></li>

										<li data-group="W" class="mui-table-view-divider mui-indexed-list-group">W</li>
									    <li data-value="WKQ" data-fn="makeTalk('王克卿');" data-tags="WangkeQing" class="mui-table-view-cell mui-indexed-list-item">王克卿<span class="mui-icon mui-icon-phone phone-right"></span></li>
										 <li data-value="W" data-tags="WuMing" class="mui-table-view-cell mui-indexed-list-item">吴明</li>
										 <li data-value="WY" data-fn="makeTalk('王一');" data-tags="WangYi" class="mui-table-view-cell mui-indexed-list-item">王一<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-group="X" class="mui-table-view-divider mui-indexed-list-group">X</li>
										<li data-value="XH" data-fn="makeTalk('肖红');" data-tags="XiaoHong" class="mui-table-view-cell mui-indexed-list-item">肖红<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="Y" class="mui-table-view-divider mui-indexed-list-group">Y</li>
										<li data-value="YSM" data-fn="makeTalk('闫世明');" data-tags="YanShiMing" class="mui-table-view-cell mui-indexed-list-item">闫世明<span class="mui-icon mui-icon-phone phone-right"></span></li>
										
										<li data-group="Z" class="mui-table-view-divider mui-indexed-list-group">Z</li>
										<li data-value="ZKY" data-fn="makeTalk('张可有');" data-tags="ZhanKeYou" class="mui-table-view-cell mui-indexed-list-item">张可有<span class="mui-icon mui-icon-phone phone-right"></span></li>
										<li data-value="ZF" data-fn="makeTalk('赵峰');" data-tags="ZhaoFeng" class="mui-table-view-cell mui-indexed-list-item">赵峰<span class="mui-icon mui-icon-phone phone-right"></span></li>
								</ul>-->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../../../../resource/mui/js/mui.indexedlist.js"></script>
	<script src="colleagues.js"></script>
	<script>
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		(function($) {
			//自适应高度
			//			var _header = document.querySelector('header.mui-bar');
			//			var _slider = document.querySelector('div.mui-slider-indicator');
			//			var _h = (document.body.offsetHeight - _header.offsetHeight - _slider.offsetHeight) + 'px';
			//			document.getElementById("msiByOrg").style.height = _h;
			//			document.getElementById("msiOften").style.height = _h;
			//			document.getElementById("item3mobile").style.height = _h;
			pageHeightInit();
			//Accordion 

			YSUI.Accordion("colAcd");
			//scroll
			$('.mui-scroll-wrapper').scroll();
		})(mui);
		//如何是分享页面-通讯录
		var news = _App.util.getUrlParamByName('news');
		mui.ready(function() {
			var header = document.querySelector('header.mui-bar');
			indexedElmtId = document.getElementById('list');
			//calc hieght
			indexedElmtId.style.height = (document.body.offsetHeight - header.offsetHeight) + 'px';
			//create
			indexedObj = window.indexedList = new mui.IndexedList(list);
		});
		mui('#colAcd').on('tap', '.ys-accNode', function() {
			eval(this.getAttribute('data-fn'));
		});
		mui('#colAcd').on('tap', '.mui-icon-phone', function() {
			eval(this.getAttribute('data-fn'));
			return false;
		});
		mui('#msiOften').on('tap', '.mui-icon-phone', function() {
			eval(this.getAttribute('data-fn'));
			return false;
		});
		mui('#msiOften').on('tap', '.ys-accNode', function() {
			eval(this.getAttribute('data-fn'));
			return false;
		});
		mui('#phoneCallUl').on('tap', '.mui-icon-phone', function() {
			eval("makeTelephone('telId2')");
			return false;
		});
		mui('#item3mobile').on('tap', '.mui-indexed-list-item', function() {
			eval(this.getAttribute('data-fn'));
			return false;
		});

		function makeTalk(toName) {
			//_App.util.goPage("../chat/im-chat.html?toUserName="+toName,"none"); 
			//这里创建聊天组
			_App.ajax({
				type: "get",
				url: basePath + 'chat!saveChatRoom.json',
				data: {
					actType: "create",
					roomtype: '2'
				},
				cache: false,
				dataType: "json",
				success: function(response) {
					//创建聊天组后，需要添加人员
					if(response) {
						addChatRoomMembers(response.json, toName);
					} else {
						mui.alert("创建群组失败!");
					}
				},
				error: function(a, b, c) {
					mui.alert("网络连接出错!");
				}
			});
			//				_App.util.goPage("../../public/chat/im-chat.html?toUserName="+encodeURIComponent(toName),"none"); 
		}

		function makeTelephone(obj) {
			//				var obj = mui("#"+obj)[0];
			//				obj.click();
			plus.device.dial('13487678574', false);
		}
		var accountName = "";
		mui.plusReady(function() {
			accountName = plus.storage.getItem("accountName");
			getOrg(); //初始化 机构数据

		});

		function swiptListener() {
			var tran = document.getElementById('sliderProgressBar').style.webkitTransform;
//			console.log(tran);
			var _width = document.getElementById('sliderProgressBar').scrollWidth;
			//			console.log(tran);
			//			console.log('一个条的宽度是：'+_width);

			var k = tran.indexOf('(') + 1; //去掉括号
			var d = tran.indexOf(',') - 2; //去掉px
			//			 console.log('k:'+k+'  d:'+d);
			var tranX = tran.substring(k, d);
			//			 alert(tran.substring(k,d));
			//			console.log('tranX:'+tranX);
			//滑动到第一个
			if(tranX <= (0.5 * _width)) {
				getOrgData();
			}
			//滑动到第二个
			else if((0.5 * _width) < tranX && tranX < (_width * 1.5)) {
				getCommon();
			} else {
				getIndexDatas();
			}
		}
		document.addEventListener('touchend', function() {
			setTimeout(swiptListener, 200);//解决在滑动太快的某一种情况  css还没有变化  监听就已经执行了

		})
		document.getElementById('commonBt').addEventListener('tap', function() {
			getCommon();
		});
		document.getElementById('indexBt').addEventListener('tap', function() {
			getIndexDatas(); //初始化索引数据
		});

		function addChatRoomMembers(data, toName) {
			var roomId = data.roomid;
			var roomName = data.roomname;
			var roomType = data.roomtype;
			var paras = [];
			var peo = {
				roomId: roomId,
				peopleName: toName
			};
			paras.push(peo);
			peo = {
				roomId: roomId,
				peopleName: accountName
			};
			paras.push(peo);
			var data_ = {
				para: JSON.stringify(paras)
			};
			_App.ajax({
				type: "get",
				url: basePath + 'chat!addChatRoomMembers.json',
				data: data_,
				cache: false,
				dataType: "json",
				success: function(response) {
					//判断是不是从分享页面跳转过来的
					if(news == 1) {
						var details = plus.webview.getWebviewById('share_list');
						mui.fire(details, 'share_list', {
							id: 1
						});
						plus.webview.getWebviewById('myPage').close();
					} else {
						//跳转到聊天组界面
						var url = "../chat/im-chat.html?chatRoomId=" + roomId + "&chatRoomName=" + encodeURIComponent(roomName) + "&createRoomPeo=" + accountName + "&type=" + roomType;
						_App.util.goPage(url, {
							pageId: 'im-chat-id', //viewId可以通过plus.webview.getWebviewById('view001');取到
							refresh: false //是否刷新viewId为view001的webview
						});
					}
				},
				error: function(a, b, c) {
					mui.alert("网络连接出错!");
				}
			});
		}
	</script>

</html>