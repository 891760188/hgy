<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>选择联系人</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--公共js-->
		<script src="../../common/AppBooter.js"></script>
		<link href="../../../resource/mui/css/mui.indexedlist.css" rel="stylesheet" />
		<style>
			html,
			body {
				height: 100%;
				overflow: hidden;
			}
			
			.phone-right{
				float: right;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		     <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">选择联系人</h1>
		    <button onclick="saveChoose();" type="button" class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" style="color: #666;">完成</button>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
				<div class="mui-slider-group">
					<div id="item3mobile" class="mui-slider-item mui-control-content">
							<div id='list' class="mui-indexed-list">
								<div class="mui-indexed-list-search mui-input-row mui-search">
									<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="搜索">
								</div>
								<div class="mui-indexed-list-bar">
									<a>A</a>
									<a>B</a>
									<a>C</a>
									<a>D</a>
									<a>E</a>
									<a>F</a>
									<a>G</a>
									<a>H</a>
									<a>I</a>
									<a>J</a>
									<a>K</a>
									<a>L</a>
									<a>M</a>
									<a>N</a>
									<a>O</a>
									<a>P</a>
									<a>Q</a>
									<a>R</a>
									<a>S</a>
									<a>T</a>
									<a>U</a>
									<a>V</a>
									<a>W</a>
									<a>X</a>
									<a>Y</a>
									<a>Z</a>
								</div>
								<div class="mui-indexed-list-alert"></div>
								<div class="mui-indexed-list-inner">
									<div class="mui-indexed-list-empty-alert">没有数据</div>
									<ul class="mui-table-view" id="phoneCallUl">
										<a href="tel:13800138000" id="telId2"></a>
										<li data-group="A" class="mui-table-view-divider mui-indexed-list-group">A</li>
										<li data-value="ANJ" data-fn="chooseThePeos('people1','anjie');" data-tags="AnJie" class="mui-table-view-cell mui-indexed-list-item">安杰<span id="people1" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="AX" data-fn="chooseThePeos('people2','AiXue');" data-tags="AiXue" class="mui-table-view-cell mui-indexed-list-item">艾雪<span id="people2" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="B" class="mui-table-view-divider mui-indexed-list-group">B</li>
										<li data-value="MKM" data-fn="chooseThePeos('people3','BaoKeMing');" data-tags="BaoKeMing" class="mui-table-view-cell mui-indexed-list-item">鲍克明<span id="people3" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="BM" data-fn="chooseThePeos('people4','BaoMing');" data-tags="BaoMing" class="mui-table-view-cell mui-indexed-list-item">包宁<span id="people4" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="C" class="mui-table-view-divider mui-indexed-list-group">C</li>
										<li data-value="CM" data-fn="chooseThePeos('people5','caiming');" data-tags="caiming" class="mui-table-view-cell mui-indexed-list-item">蔡明<span id="people5" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="D" class="mui-table-view-divider mui-indexed-list-group">D</li>
										<li data-value="DHJ" data-fn="chooseThePeos('people6','DuHaiJu');" data-tags="DuHaiJu" class="mui-table-view-cell mui-indexed-list-item">杜海菊<span id="people6" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="E" class="mui-table-view-divider mui-indexed-list-group">E</li>
										<li data-value="EF" data-fn="chooseThePeos('people7','ErFei');" data-tags="ErFei" class="mui-table-view-cell mui-indexed-list-item">呃飞<span id="people7" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="F" class="mui-table-view-divider mui-indexed-list-group">F</li>
										<li data-value="FHM" data-fn="chooseThePeos('people8','FangHeMing');" data-tags="FangHeMing" class="mui-table-view-cell mui-indexed-list-item">方和明<span id="people8" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="G" class="mui-table-view-divider mui-indexed-list-group">G</li>
										<li data-value="GM" data-fn="chooseThePeos('people9','GongMei');" data-tags="GongMei" class="mui-table-view-cell mui-indexed-list-item">龚梅<span id="people9" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="GX" data-fn="chooseThePeos('people10','GuoXiang');" data-tags="GuoXiang" class="mui-table-view-cell mui-indexed-list-item">郭襄<span id="people10" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-group="H" class="mui-table-view-divider mui-indexed-list-group">H</li>
										<li data-value="HY" data-fn="chooseThePeos('people11','HuangYe');" data-tags="HuangYe" class="mui-table-view-cell mui-indexed-list-item">黄页<span id="people11" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="J" class="mui-table-view-divider mui-indexed-list-group">J</li>
										<li data-value="JMJ" data-fn="chooseThePeos('people12','JinMingjue');" data-tags="JinMingjue" class="mui-table-view-cell mui-indexed-list-item">金铭决<span id="people12" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="K" class="mui-table-view-divider mui-indexed-list-group">K</li>
										<li data-value="KJT" data-fn="chooseThePeos('people13','KanJinTao');" data-tags="KanJinTao" class="mui-table-view-cell mui-indexed-list-item">阚锦涛<span id="people13" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="L" class="mui-table-view-divider mui-indexed-list-group">L</li>
										<li data-value="LJC" data-fn="chooseThePeos('people14','LaiJinCheng');" data-tags="LaiJinCheng" class="mui-table-view-cell mui-indexed-list-item">赖金成<span id="people14" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="LS" data-fn="chooseThePeos('people15','LiShuang');" data-tags="LiShuang" class="mui-table-view-cell mui-indexed-list-item">李双<span id="people15" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="LS" data-fn="chooseThePeos('people16','LaiSi');" data-tags="LaiSi" class="mui-table-view-cell mui-indexed-list-item">李四<span id="people16" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-group="M" class="mui-table-view-divider mui-indexed-list-group">M</li>
										<li data-value="MH" data-fn="chooseThePeos('people17','Miaohong');" data-tags="Miaohong" class="mui-table-view-cell mui-indexed-list-item">苗红<span id="people17" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="N" class="mui-table-view-divider mui-indexed-list-group">N</li>
										<li data-value="NCM" data-fn="chooseThePeos('people18','NingCaiMing');" data-tags="NingCaiMing" class="mui-table-view-cell mui-indexed-list-item">宁蔡明<span id="people18" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="P" class="mui-table-view-divider mui-indexed-list-group">P</li>
										<li data-value="PF" data-fn="chooseThePeos('people19','PengFei');" data-tags="PengFei" class="mui-table-view-cell mui-indexed-list-item">彭飞<span id="people19" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-group="Q" class="mui-table-view-divider mui-indexed-list-group">Q</li>
										<li data-value="QMJ" data-fn="chooseThePeos('people20','QianMingJun');" data-tags="QianMingJun" class="mui-table-view-cell mui-indexed-list-item">钱明骏<span id="people20" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="R" class="mui-table-view-divider mui-indexed-list-group">R</li>
										<li data-value="RX" data-fn="chooseThePeos('people21','RENXUE');" data-tags="RENXUE" class="mui-table-view-cell mui-indexed-list-item">任雪<span id="people21" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-group="S" class="mui-table-view-divider mui-indexed-list-group">S</li>
										<li data-value="SF" data-fn="chooseThePeos('people22','ShaoFei');" data-tags="ShaoFei" class="mui-table-view-cell mui-indexed-list-item">少飞<span id="people22" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="T" class="mui-table-view-divider mui-indexed-list-group">T</li>
										<li data-value="TD" data-fn="chooseThePeos('people23','TangDan');" data-tags="TangDan" class="mui-table-view-cell mui-indexed-list-item">唐丹<span id="people23" class="mui-icon icon-radio-unchecked phone-right"></span></li>

										<li data-group="W" class="mui-table-view-divider mui-indexed-list-group">W</li>
									    <li data-value="WKQ" data-fn="chooseThePeos('people24','WangkeQing');" data-tags="WangkeQing" class="mui-table-view-cell mui-indexed-list-item">王克卿<span id="people24" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										 <li data-value="W" data-tags="WuMing" class="mui-table-view-cell mui-indexed-list-item">吴明</li>
										 <li data-value="WY" data-fn="chooseThePeos('people25','WangYi');" data-tags="WangYi" class="mui-table-view-cell mui-indexed-list-item">王一<span id="people25" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-group="X" class="mui-table-view-divider mui-indexed-list-group">X</li>
										<li data-value="XH" data-fn="chooseThePeos('people26','XiaoHong');" data-tags="XiaoHong" class="mui-table-view-cell mui-indexed-list-item">肖红<span id="people26" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="Y" class="mui-table-view-divider mui-indexed-list-group">Y</li>
										<li data-value="YSM" data-fn="chooseThePeos('people27','YanShiMing');" data-tags="YanShiMing" class="mui-table-view-cell mui-indexed-list-item">闫世明<span id="people27" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										
										<li data-group="Z" class="mui-table-view-divider mui-indexed-list-group">Z</li>
										<li data-value="ZKY" data-fn="chooseThePeos('people28','ZhanKeYou');" data-tags="ZhanKeYou" class="mui-table-view-cell mui-indexed-list-item">张可有<span id="people28" class="mui-icon icon-radio-unchecked phone-right"></span></li>
										<li data-value="ZF" data-fn="chooseThePeos('people29','ZhaoFeng');" data-tags="ZhaoFeng" class="mui-table-view-cell mui-indexed-list-item">赵峰<span id="people29" class="mui-icon icon-radio-unchecked phone-right"></span></li>
									</ul>
								</div>
						</div>	
				</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../../../resource/mui/js/mui.indexedlist.js"></script>
	<script>
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});			
		
		mui.ready(function() {
			var header = document.querySelector('header.mui-bar');
			var list = document.getElementById('list');
			
			//calc hieght
			list.style.height = (document.body.offsetHeight - header.offsetHeight) + 'px';
			//create
			window.indexedList = new mui.IndexedList(list);
		});
		
		
		mui('#item3mobile').on('tap','.mui-indexed-list-item',function(){
			eval(this.getAttribute('data-fn'));
			return false;			
		});
		var chatRoomId = _App.util.getUrlParamByName("chatRoomId");
		var chatRoomName = decodeURIComponent(_App.util.getUrlParamByName("chatRoomName"));
		var choosePeos_ = ",";
		function chooseThePeos(id,name){
			var obj = document.getElementById(id);
			if(obj.classList.contains("icon-radio-checked")){
				choosePeos_ = choosePeos_.replace(","+name+",","");
				obj.classList.add('icon-radio-unchecked');
				obj.classList.remove('icon-radio-checked');
			}
			else{
				choosePeos_ += name+",";
				obj.classList.remove('icon-radio-unchecked');
				obj.classList.add('icon-radio-checked');
			}				
		};
		
		function saveChoose(){
			if(choosePeos_ == ","){//没有选择人员，不需要保存数据库
				mui.back();//关闭并不需要刷新主界面
			}else{//保存数据库
				var datas = zzDatas();
				var data_ = {para:JSON.stringify(datas)};
				_App.ajax({
			    	type : "get",
			  		url :basePath + 'chat!addChatRoomMembers.json',
					data:data_,
			 		cache: false,
			   		dataType: "json",
			   		success : function(response){
			   			selectBack();
					},
			 		error:function(a,b,c){
			 			mui.alert("网络连接出错!");
			 		}
			 	});
			}
		}
		
		function zzDatas(){
			var datas = [];
			var sp = choosePeos_.split(",");
			for(var i = 0; i < sp.length; i++){
				if(sp[i]){//有值
					var mp = {
						roomId:chatRoomId,
						peopleName:sp[i]
					};
					datas.push(mp);
				}
			}
			return datas;
		}
		
		var backPage;
		function plusReady(){
			backPage = plus.webview.getWebviewById("im-groupsView-id");
		}
		if(window.plus){
			plusReady();
		}else{
			document.addEventListener("plusready",plusReady,false);
		}
		function selectBack(){
			if(!backPage){
		  		alert("页面还未准备好，请稍后...");
		  		return false;
		  	}
	  		//触发详情页面的newsId事件
		 	mui.fire(backPage,'chooseLinkManEvent__',{
		    	act:"refresh",
		    	chatRoomId:chatRoomId,
		    	chatRoomName:chatRoomName
		  	});
          	plus.webview.currentWebview().close();
		}
	</script>
</html>